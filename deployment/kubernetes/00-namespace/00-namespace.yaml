# ==================================================================================
# Kubernetes Namespace & Base Configuration
# ==================================================================================

apiVersion: v1
kind: Namespace
metadata:
  name: healthpay
  labels:
    name: healthpay
    environment: production
    app.kubernetes.io/name: healthpay-ledger-v2
    app.kubernetes.io/version: "2.0.0"

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: healthpay-config
  namespace: healthpay
data:
  # Application Configuration
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  API_VERSION: "v2"
  
  # Service URLs (internal)
  AUTH_SERVICE_URL: "http://auth-service.healthpay.svc.cluster.local:3001"
  WALLET_SERVICE_URL: "http://wallet-service.healthpay.svc.cluster.local:3002"
  PAYMENT_SERVICE_URL: "http://payment-service.healthpay.svc.cluster.local:3003"
  TRANSACTION_SERVICE_URL: "http://transaction-service.healthpay.svc.cluster.local:3004"
  
  # Database Configuration
  POSTGRES_HOST: "postgresql-ha.healthpay.svc.cluster.local"
  POSTGRES_PORT: "5432"
  POSTGRES_DB: "healthpay_ledger"
  
  SCYLLA_HOSTS: "scylla-0.scylla.healthpay.svc.cluster.local,scylla-1.scylla.healthpay.svc.cluster.local,scylla-2.scylla.healthpay.svc.cluster.local"
  SCYLLA_KEYSPACE: "healthpay_balances"
  SCYLLA_DATACENTER: "dc1"
  
  # Redis Configuration
  REDIS_HOST: "redis-ha-master.healthpay.svc.cluster.local"
  REDIS_PORT: "6379"
  
  # Kafka Configuration
  KAFKA_BROKERS: "kafka-0.kafka-headless.healthpay.svc.cluster.local:9092,kafka-1.kafka-headless.healthpay.svc.cluster.local:9092,kafka-2.kafka-headless.healthpay.svc.cluster.local:9092"
  KAFKA_TOPIC: "healthpay.events.wallet"
  
  # External Services
  CEQUENS_SMS_URL: "https://apis.cequens.com/api/v1"
  FAWRY_URL: "https://www.atfawry.com"
  PAYMOB_URL: "https://accept.paymob.com/api"
  
  # Monitoring
  PROMETHEUS_PORT: "9090"
  METRICS_ENABLED: "true"
  
  # Rate Limiting
  RATE_LIMIT_WINDOW_MS: "60000"
  RATE_LIMIT_MAX_REQUESTS: "100"

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: healthpay-env
  namespace: healthpay
data:
  # Egyptian-specific configuration
  COUNTRY: "EG"
  TIMEZONE: "Africa/Cairo"
  DEFAULT_CURRENCY: "EGP"
  DEFAULT_LANGUAGE: "ar"
  
  # Phone number validation
  PHONE_REGEX: "^(\\+20|20|0)?1[0125]\\d{8}$"
  
  # National ID validation
  NATIONAL_ID_REGEX: "^\\d{14}$"
  
  # Business Configuration
  MIN_WALLET_BALANCE: "0"
  MAX_TRANSACTION_AMOUNT: "50000"
  MAX_DAILY_TRANSACTIONS: "100"
  
  # KYC Levels
  KYC_LEVEL_0_LIMIT: "1000"
  KYC_LEVEL_1_LIMIT: "10000"
  KYC_LEVEL_2_LIMIT: "50000"
  KYC_LEVEL_3_LIMIT: "unlimited"
  
  # Circuit Breaker
  CIRCUIT_BREAKER_THRESHOLD: "5"
  CIRCUIT_BREAKER_TIMEOUT: "30000"
  CIRCUIT_BREAKER_RESET_TIME: "60000"
